<!-- 编辑主页 -->
<template>
	<page-layer :narData="narData" classs="padd" class="edit-page">
		<phone-model>
			<div class="content">
				<edit-element @setElement="setElement" :elementIndex="1" :class="selectElementIndex == 1 ? 'active' : ''">
					<el-carousel height="150px">
					 <el-carousel-item v-for="(item, index) in adHQInfo" :key="index">
				      	 <img :src="item.picture" />
				      </el-carousel-item>
				      <el-carousel-item v-for="(item, index) in allHeaderData" :key="index">
				       <img :src="item.picture" />
				      </el-carousel-item>
				    </el-carousel>
				</edit-element>
				<edit-element @setElement="setElement" :elementIndex="2" class="nar-element" :class="selectElementIndex == 2 ? 'active' : ''">
					<editor-nar></editor-nar>
				</edit-element>
				<edit-element @setElement="setElement" :elementIndex="3" class="feature-element" :class="selectElementIndex == 3 ? 'active' : ''">
					<editor-feature></editor-feature>
				</edit-element>
				<edit-element @setElement="setElement" :elementIndex="4" class="prod-element" :class="selectElementIndex == 4 ? 'active' : ''">
					<editor-re-prod></editor-re-prod>
				</edit-element>
			</div>

		</phone-model>
		<div class="right">
				<setting-area v-show="selectElementIndex == 1" title="头部广告">
					<setting-advertising ></setting-advertising>
				</setting-area>
				<setting-area v-show="selectElementIndex == 2" title="商品快捷导航">
					<setting-nar></setting-nar>
				</setting-area>
				<setting-area v-show="selectElementIndex == 3" title="选择排版样式">
					<settinFeature></settinFeature>
				</setting-area>
				<setting-area v-show="selectElementIndex == 4" title="推荐食材">
					<settinReferralsProd></settinReferralsProd>
				</setting-area>
				<div class="event" >
					<el-button>取消</el-button>
					<el-button type="primary" @click="submitHome">保存</el-button>
				</div>	
		</div>
		
		
			
	</page-layer>
</template>
<script>
import pageLayer from "components/common/page-layer"
import phoneModel from "components/marketing/editor/phone-model"
import settingArea from "components/marketing/editor/setting-area"
import editElement from "components/marketing/editor/edit-element"
import editorNar from "components/marketing/editor/home/editor-nar"
import editorFeature from "components/marketing/editor/home/editor-feature"
import editorReProd from "components/marketing/editor/home/editor-re-prod"
import settingAdvertising from "components/marketing/editor/home/setting-advertising"
import settinFeature from "components/marketing/editor/home/setting-feature"
import settinReferralsProd from "components/marketing/editor/home/setting-referrals-prod"
import settingNar from "components/marketing/editor/home/setting-nar"
import { mapGetters } from 'vuex'
import homeAction from "action/marketing/home"
export default{
	data() {
		return{
			narData : [
	    	  	{
	    	  		name : "主页管理",
	    	  		router : ""
	    	  	}
	    	],
	    	selectElementIndex : 1
		}
	},
	components : {
		pageLayer,
		phoneModel,
		settingArea,
		editElement,
		editorNar,
		editorFeature,
		editorReProd,
		settingAdvertising,
		settinFeature,
		settinReferralsProd,
		settingNar
	},
	created() {
		this.$store.dispatch('getHeaderData');
	},
	computed : {
    	...mapGetters([
	      'allHeaderData',
	      'narsData',
	      'featureInfo',
	      'adHQInfo'
	    ])
    },
	methods : {
		setElement(index) {
			this.selectElementIndex = index;
		},
		submitHome() {
			var index = this.selectElementIndex, _that = this;
			if(index == 1) {
				var str = JSON.stringify(this.allHeaderData);
				var data = {
					json : str
				}
				homeAction.saveAdInfo(this, data);
			} else if(index == 2) {
				var str = JSON.stringify(this.narsData);
				var data = {
					json : str
				}
				homeAction.saveCategoryNar(this, data);
			} else if(index == 3) {
				var info = this.featureInfo;
				info.data.map((item) => {
					var error = "";
					if(!item.picture) {
						error = "请上传图片";
					} else if(item.featureAreaId == "" || item.featureTypeId == "") {
						error = "请选择主题活动";
					}
					if(error != "") {
						_that.$message(error);
						return false;
					}
					
				})
				var str = JSON.stringify(info);
				var data = {
					json : str
				}
				homeAction.saveFeatureInfo(this,data);
			}
		}
	}
}
</script>
<style lang="less" scoped>
	@import "../../../common/less/config.less";
	.edit-page{
		position: relative;
		.right{
			float: left;
			.event{
				text-align: center;
				padding:20px 60px;
			}
		}
	}
	.content{
		.el-carousel__item {
			img{
				max-width: 100%;
			}
		  }

		  .nar-element{
		  		position: relative;
		  		.nar-layer{
		  			width:100%;
		  			height:40px;
		  			background: #FFF;
		  			position: absolute;
		  			left:0;
		  			z-index:99;
		  			top:-20px;
		  			border-radius: 50%;
		  		}
		  }
		  .prod-element{
		  		padding-bottom: 10px;
		  }
		  .nar-wrap{
		  		height:90px;
		  		background: #FFF;
		  		position: relative;
		  		z-index:100;
		  		.n-item{
		  			float:left;
		  			width:25%;
		  			text-align: center;
		  			font-size:@size-title;
		  			.icon{
		  				display: inline-block;
		  				width:45px;
		  				height:45px;
		  				margin-top:15px;
		  				img{
		  					width:100%;
		  					height:100%;
		  				}
		  			}
		  		}
		  }
	}
</style>